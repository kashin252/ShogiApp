import {
    FU, KYO, KEI, GIN, KIN, KAKU, HI, OU,
    TO, NKYO, NKEI, NGIN, UMA, RYU, ZOU, TAISHI
} from '../types/game.types';

// ========================================
// PST（Piece-Square Tables）- 詳細版
// ========================================

// 歩：前方中央が強い
export const PST_FU = new Int8Array([
    45, 50, 55, 60, 65, 60, 55, 50, 45,  // 1段目（敵陣）
    35, 40, 45, 50, 55, 50, 45, 40, 35,  // 2段目
    30, 35, 40, 45, 50, 45, 40, 35, 30,  // 3段目
    10, 15, 20, 25, 30, 25, 20, 15, 10,  // 4段目
    5, 8, 10, 15, 20, 15, 10, 8, 5,  // 5段目
    0, 3, 5, 8, 10, 8, 5, 3, 0,  // 6段目
    0, 0, 0, 0, 0, 0, 0, 0, 0,  // 7段目（初期位置）
    0, 0, 0, 0, 0, 0, 0, 0, 0,  // 8段目
    0, 0, 0, 0, 0, 0, 0, 0, 0   // 9段目
]);

// 香車：敵陣に近いほど良い
export const PST_KYO = new Int8Array([
    30, 30, 30, 30, 30, 30, 30, 30, 30,
    25, 25, 25, 25, 25, 25, 25, 25, 25,
    20, 20, 20, 20, 20, 20, 20, 20, 20,
    15, 15, 15, 15, 15, 15, 15, 15, 15,
    10, 10, 10, 10, 10, 10, 10, 10, 10,
    5, 5, 5, 5, 5, 5, 5, 5, 5,
    0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0,
    20, 10, 10, 10, 10, 10, 10, 10, 20
]);

// 桂馬：跳ねられる位置が良い
export const PST_KEI = new Int8Array([
    0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0,
    10, 15, 20, 25, 30, 25, 20, 15, 10,
    5, 10, 15, 20, 25, 20, 15, 10, 5,
    0, 5, 10, 15, 20, 15, 10, 5, 0,
    0, 0, 5, 10, 15, 10, 5, 0, 0,
    0, 0, 0, 5, 5, 5, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0
]);

// 銀：前方中央が強い
export const PST_GIN = new Int8Array([
    -5, -5, 0, 5, 10, 5, 0, -5, -5,
    0, 5, 10, 15, 20, 15, 10, 5, 0,
    5, 10, 15, 20, 25, 20, 15, 10, 5,
    5, 10, 15, 18, 20, 18, 15, 10, 5,
    0, 5, 10, 12, 15, 12, 10, 5, 0,
    0, 0, 5, 8, 10, 8, 5, 0, 0,
    0, 0, 0, 5, 5, 5, 0, 0, 0,
    -5, -5, 0, 0, 0, 0, 0, -5, -5,
    -10, -10, -5, -5, -5, -5, -5, -10, -10
]);

// 金：玉の近くにいると良い
export const PST_KIN = new Int8Array([
    -10, -10, 0, 5, 5, 5, 0, -10, -10,
    0, 5, 10, 15, 15, 15, 10, 5, 0,
    5, 10, 15, 18, 20, 18, 15, 10, 5,
    5, 8, 12, 15, 18, 15, 12, 8, 5,
    0, 5, 10, 12, 15, 12, 10, 5, 0,
    0, 0, 5, 8, 10, 8, 5, 0, 0,
    5, 5, 10, 12, 15, 12, 10, 5, 5,
    5, 10, 10, 15, 15, 15, 10, 10, 5,
    0, 5, 5, 10, 10, 10, 5, 5, 0
]);

// 角：中央が強い
export const PST_KAKU = new Int8Array([
    20, 15, 10, 10, 10, 10, 10, 15, 20,
    15, 25, 15, 15, 15, 15, 15, 25, 15,
    10, 15, 30, 20, 20, 20, 30, 15, 10,
    10, 15, 20, 35, 25, 35, 20, 15, 10,
    10, 15, 20, 25, 40, 25, 20, 15, 10,
    10, 15, 20, 35, 25, 35, 20, 15, 10,
    10, 15, 30, 20, 20, 20, 30, 15, 10,
    15, 25, 15, 15, 15, 15, 15, 25, 15,
    20, 15, 10, 10, 10, 10, 10, 15, 20
]);

// 飛車：敵陣2段目が強い、自陣では端が良い（中央はペナルティ）
export const PST_HI = new Int8Array([
    25, 20, 15, 10, 10, 10, 15, 20, 25,   // 1段目（敵陣）
    30, 25, 20, 15, 15, 15, 20, 25, 30,   // 2段目
    20, 20, 15, 12, 12, 12, 15, 20, 20,   // 3段目
    15, 15, 12, 10, 10, 10, 12, 15, 15,   // 4段目
    10, 10, 10, 5, 5, 5, 10, 10, 10,   // 5段目
    5, 5, 5, 0, 0, 0, 5, 5, 5,   // 6段目
    5, 0, -5, -10, -15, -10, -5, 0, 5,   // 7段目（自陣中央はマイナス）
    10, 5, 0, -10, -20, -10, 0, 5, 10,   // 8段目
    20, 15, 10, 0, -10, 0, 10, 15, 20    // 9段目（初期位置付近が良い）
]);

// 玉：序盤は端で囲う
export const PST_OU_OPENING = new Int8Array([
    -50, -40, -30, -30, -30, -30, -30, -40, -50,
    -40, -30, -20, -20, -20, -20, -20, -30, -40,
    -30, -20, -10, -10, -10, -10, -10, -20, -30,
    -30, -20, -10, -5, -5, -5, -10, -20, -30,
    -30, -20, -10, -5, 0, -5, -10, -20, -30,
    -20, -10, 0, 5, 5, 5, 0, -10, -20,
    -10, 0, 10, 15, 10, 15, 10, 0, -10,
    0, 15, 20, 10, 5, 10, 20, 15, 0,
    20, 30, 25, 10, 0, 10, 25, 30, 20
]);

// 玉：終盤は中央へ
export const PST_OU_ENDGAME = new Int8Array([
    -30, -20, -10, -5, 0, -5, -10, -20, -30,
    -20, -10, 0, 5, 10, 5, 0, -10, -20,
    -10, 0, 10, 15, 20, 15, 10, 0, -10,
    -5, 5, 15, 20, 25, 20, 15, 5, -5,
    0, 10, 20, 25, 30, 25, 20, 10, 0,
    -5, 5, 15, 20, 25, 20, 15, 5, -5,
    -10, 0, 10, 15, 20, 15, 10, 0, -10,
    -20, -10, 0, 5, 10, 5, 0, -10, -20,
    -30, -20, -10, -5, 0, -5, -10, -20, -30
]);

// 象：中央前方が強い
export const PST_ZOU = new Int8Array([
    0, 5, 10, 15, 20, 15, 10, 5, 0,
    5, 15, 20, 25, 30, 25, 20, 15, 5,
    10, 20, 25, 30, 35, 30, 25, 20, 10,
    10, 18, 22, 28, 32, 28, 22, 18, 10,
    5, 12, 18, 22, 25, 22, 18, 12, 5,
    0, 8, 12, 15, 18, 15, 12, 8, 0,
    0, 5, 8, 10, 12, 10, 8, 5, 0,
    0, 0, 5, 5, 8, 5, 5, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0
]);

// 王の周囲8マスの利きテーブル
export const KING_NEIGHBORS: number[][] = [];
for (let sq = 0; sq < 81; sq++) {
    const r = Math.floor(sq / 9);
    const c = sq % 9;
    const neighbors: number[] = [];
    for (let dr = -1; dr <= 1; dr++) {
        for (let dc = -1; dc <= 1; dc++) {
            if (dr === 0 && dc === 0) continue;
            const nr = r + dr;
            const nc = c + dc;
            if (nr >= 0 && nr < 9 && nc >= 0 && nc < 9) {
                neighbors.push(nr * 9 + nc);
            }
        }
    }
    KING_NEIGHBORS.push(neighbors);
}

// ========================================
// PST参照（外部エクスポート）
// ========================================
export function getPstBonus(pt: number, sq: number, side: number): number {
    const idx = side === 0 ? sq : (80 - sq);

    switch (pt) {
        case FU:
            return PST_FU[idx];
        case KYO:
            return PST_KYO[idx];
        case KEI:
            return PST_KEI[idx];
        case GIN:
            return PST_GIN[idx];
        case KIN:
        case TO:
        case NKYO:
        case NKEI:
        case NGIN:
            return PST_KIN[idx];
        case KAKU:
            return PST_KAKU[idx];
        case HI:
            return PST_HI[idx];
        case UMA:
            return PST_KAKU[idx] + 15;
        case RYU:
            return PST_HI[idx] + 20;
        case ZOU:
        case TAISHI:
            return PST_ZOU[idx];
        case OU:
            return 0; // 手動評価（安全度）で扱う
        default:
            return 0;
    }
}
